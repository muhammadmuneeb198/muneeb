---
apiVersion: v1
kind: Secret
metadata:
  name: garden-setup-config
  namespace: default
type: Opaque
data:
  kubeconfig: bnVsbA==
  acre.yaml: >-
    Y3JlZGVudGlhbHM6ICZyZWZfMAogIHNlcnZpY2VhY2NvdW50Lmpzb246IG51bGwKbGFuZHNjYXBlOgogIG5hbWU6IG15LWdhcmRlbi1jbG91ZAogIGNsdXN0ZXI6CiAgICBrdWJlY29uZmlnOiAuL2t1YmVjb25maWcKICAgIGRvbWFpbjogbnVsbAogICAgaWFhczogZ2NwCiAgICByZWdpb246IGV1cm9wZS13ZXN0MQogIG5ldHdvcmtzOgogICAgcG9kczogbnVsbAogICAgbm9kZXM6IG51bGwKICAgIHNlcnZpY2VzOiBudWxsCiAgaWFhczoKICAgIHJlZ2lvbjogZXVyb3BlLXdlc3QxCiAgICB6b25lczoKICAgICAgLSBldXJvcGUtd2VzdDEtYgogICAgICAtIGV1cm9wZS13ZXN0MS1jCiAgICAgIC0gZXVyb3BlLXdlc3QxLWQKICAgIGNyZWRlbnRpYWxzOiAqcmVmXzAKICBldGNkOgogICAgYmFja3VwOgogICAgICB0eXBlOiBnY3MKICAgICAgcmVnaW9uOiBldXJvcGUtd2VzdDEKICAgICAgY3JlZGVudGlhbHM6ICpyZWZfMAogIGRuczoKICAgIHR5cGU6IGdvb2dsZS1jbG91ZGRucwogICAgY3JlZGVudGlhbHM6ICpyZWZfMAogIGlkZW50aXR5OgogICAgdXNlcnM6CiAgICAgIC0gZW1haWw6IG51bGwKICAgICAgICB1c2VybmFtZTogbnVsbAogICAgICAgIHBhc3N3b3JkOiBudWxsCg==
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: garden-setup-state
  namespace: default
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: v1
kind: Pod
metadata:
  name: garden-setup-installer
  namespace: default
spec:
  restartPolicy: Never
  containers:
    - name: garden-setup-installer
      image: 'diaphteiros/garden-setup:stable'
      imagePullPolicy: Always
      command:
        - ./run.sh
        - '--color'
        - deploy
        - '-An'
      resources: {}
      volumeMounts:
        - name: garden-setup-config
          mountPath: /etc/garden-setup/config
        - name: garden-setup-state
          mountPath: /landscape
  volumes:
    - name: garden-setup-config
      secret:
        secretName: garden-setup-config
    - name: garden-setup-state
      persistentVolumeClaim:
        claimName: garden-setup-state
